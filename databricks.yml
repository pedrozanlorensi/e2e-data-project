bundle:
  name: e2e-data-project

include:
  - resources/*.yml

targets:
  dev:
    mode: development
    default: true
    workspace:
      host: https://adb-4181970831265458.18.azuredatabricks.net/
    variables:
      catalog_name: pedroz_e2edata_dev
      environment: dev
    # Override permissions for dev environment
    resources:
      jobs:
        data_ingestion_job:
          permissions:
            - level: "CAN_MANAGE"
              user_name: "power.user@address.com"
            - level: "CAN_MANAGE_RUN"
              user_name: "development.user@address.com"
        model_training_job:
          permissions:
            - level: "CAN_MANAGE"
              user_name: "power.user@address.com"
            - level: "CAN_MANAGE_RUN"
              user_name: "development.user@address.com"
        model_deployment_job:
          permissions:
            - level: "CAN_MANAGE"
              user_name: "power.user@address.com"
            - level: "CAN_MANAGE_RUN"
              user_name: "development.user@address.com"
        batch_inference_job:
          permissions:
            - level: "CAN_MANAGE"
              user_name: "power.user@address.com"
            - level: "CAN_MANAGE_RUN"
              user_name: "development.user@address.com"

  prod:
    mode: production
    workspace:
      host: https://adb-4181970831265458.18.azuredatabricks.net/
    variables:
      catalog_name: pedroz_e2edata_prod
      environment: prod
    
    # Add any production-specific overrides here
    run_as:
      # Use service principal for production
      service_principal_name: ${var.service_principal_application_id}
    
    # Override permissions for prod environment (only power user)
    resources:
      jobs:
        data_ingestion_job:
          permissions:
            - level: "CAN_MANAGE"
              user_name: "power.user@address.com"
        model_training_job:
          permissions:
            - level: "CAN_MANAGE"
              user_name: "power.user@address.com"
        model_deployment_job:
          permissions:
            - level: "CAN_MANAGE"
              user_name: "power.user@address.com"
        batch_inference_job:
          permissions:
            - level: "CAN_MANAGE"
              user_name: "power.user@address.com"

variables:
  catalog_name:
    description: "Name of the Unity Catalog to use"
    default: "default_catalog"
  environment:
    description: "Environment name (dev/prod)"
    default: "dev"
  service_principal_application_id:
    description: "Service Principal Application ID for authentication"
    default: "${env.DATABRICKS_CLIENT_ID}" 